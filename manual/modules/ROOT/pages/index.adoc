= Audiopilot

== Links

Source: https://github.com/twocanplugin/demo_plugin[Github Repository]

Releases: https://github.com/audiopilot/demo_plugin/releases[Github Releases]


Forum:
http://www.cruisersforum.com/forums/f134/demo_plugin.html[Cruiser's
Forum Demo Plugin Thread]

== 1. What and Why

Demo Plugin

== 2. Install

image::demo_plugin-01.png

Download the plugin tarball from the repository. Install using the plugin manager. Tools→Plugins→Import plugin.

image::demo_plugin-02.png

The plugin manager displays a dialog indicating the plugin has been successfully installed.

image::demo_plugin-03.png

== 3. Enabling

Enable the plugin using Tools→Plugins, finding the Demo Plugin entry and tick the checkbox.

image::demo_plugin-04.png

== 4. Using the OpenCPN Plugin API's

=== Chapter 1. Basic plugin, Mandatory API's, Logging, Plugin Folders

This is a basic plugin, that demonstrates the mandatory API's that a plugin MUST support.

Note that the class that implements the plugin, derives from an OpenCPN plugin base class. Over successive versions of OpenCPN
new functions and members have been added to the base classes. The plugin need only inherit from a base class that provides the
API's required for the plugin's desired capabilites.

Eg.DemoPlugin::DemoPlugin(void* ppimgr) : opencpn_plugin_117(ppimgr) is derived from the OpenCPN Plugin API version 1.17 base class

The mandatory API's that all plugins must implement

These two API's indicate what version of the OpenCPN API's are supported
GetAPIVersionMajor()
Eg. if the plugin is derived from OpenCPN Plugin API 1.17, the major version number is 1

GetAPIVersionMinor()
Eg. if the plugin is derived from OpenCPN Plugin API 1.17, the minor version number is 17

These three API's indicate the version number of the plugin
GetPlugInVersionMajor()
Eg. If the plugin version is 1.2.3, the major version is 1

GetPlugInVersionMinor() 
Eg. If the plugin version is 1.2.3, the major version is 2

GetPlugInVersionPatch() 
Eg. If the plugin version is 1.2.3, the patch version is 3

This returns the name of the plugin and is displayed in the Plugin Manager
GetCommonName() 

The following two API's return a long and short description, both of which are displayed in the Plugin Manager
GetShortDescription()

GetLongDescription()

This API returns the icon for the plugin which is displayed in the Plugin Manager. It should be a 32 x 32 pixel bitmap.
GetPlugInBitmap() 

image::demo_plugin-04.png

In addition the plugin dumps some of the OpenCPN standard folder paths and user's measurement units into the OpenCPN log file
using wxLogMessage. This OpenCPN log is the preferred mechanism for plugins to log messages. To log important error messages, 
you can also us wxLogError.

=== Chapter 2. Configuration (Default Settings)

OpenCPN and plugins persist configuration settings using the wxWidgets file based configuration class. This allows settings
to be persisted in a standard ini file format.

Settings can saved using code similar to:
[source,cpp]
----
wxFileConfig* configSettings = GetOCPNConfigObject();
	if (configSettings) {
		configSettings->SetPath("/PlugIns/DemoPlugin");
		configSettings->Write("A_Boolean_Value", g_someBooleanValue);
		configSettings->Write("An_Integer_Value", g_someIntegerValue);
		configSettings->Write("A_String_Value", g_someStringValue);
	}
----

Upon plugin installation and enabling, an OpenCPN Callback API SetDefaults can be implemented to allow the plugin to perform its initial
configuration. In this example, a wxWizard dialog is displayed to allow the users to configure the plugin's settings. 
However developers are free to implement any UI they wish, or in fact not display any UI, rather just adopt some default values.

[source,cpp]
----
void DemoPlugin::SetDefaults(void) {
	auto installationWizard = std::make_unique<DemoWizard>(GetOCPNCanvasWindow());
	if (installationWizard->RunWizard(installationWizard->m_pages.at(0))) {
		SaveSettings();
	}
}
----

image::demo_plugin-05.png 

=== Chapter 3. Settings/Preferences

There are two mechanisms that may be used to display an interface to allow users to configure the plugin.
The first mechanism adds a notebook page to any of the notebook tabs (Display, Charts, Ship, User) in the OpenCPN Toolbox.
This requires the INSTALL_TOOLBOX_PAGE value to be returned in the Init function and the OnSetupOptions function to be overridden 

[source,cpp]
----
void DemoPlugin::OnSetupOptions(void) {
	auto toolBoxWindow = AddOptionsPage(OptionsParentPI::PI_OPTIONS_PARENT_UI, _("Demo Settings"));
	auto toolboxSizer = new wxBoxSizer(wxVERTICAL);
	toolBoxWindow->SetSizer(toolboxSizer);
	auto demoToolbox =  new DemoToolbox(toolBoxWindow);
	toolboxSizer->Add(demoToolbox, 1, wxALL | wxEXPAND);
}
----

image::demo_plugin-06.png 

The second mechanism is for the plugin to provide its own dialog which is displayed from the plugin's preference option. This requires
the WANTS_PREFERENCES value to be returned in the Init function and the ShowPreferencesDialog function to be overridden.

image::demo_plugin-07.png

[source,cpp]
----
void DemoPlugin::ShowPreferencesDialog(wxWindow* parent) {
	auto demoSettings = std::make_unique<DemoSettings>(parent, wxID_ANY, _("Demo Preferences"));
	if (wxID_OK == demoSettings->ShowModal()) {
		SaveSettings();
	}
}
----

image::demo_plugin-08.png


=== Chapter 4. Context Menus

=== Chapter 5. Toolbar

=== Chapter 6. NMEA 0183

=== Chapter 7. NMEA 2000

=== Chapter 8. SignalK

=== Chapter 9. OCPN Messaging

=== Chapter 10. Routes & Waypoints

=== Chapter 11. Drawing on Canvas (non OpenGL)

=== Chapter 12. Drawing on Canvas (OpenGL)

=== Chapter 13. wxWidgets Advabced User Interface
Chapter 14. Chart


== 5. FAQ
